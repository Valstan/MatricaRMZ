# MatricaRMZ — блокчейн‑слой (ledger)

## Что сейчас защищает блокчейн
- Неизменяемый журнал изменений по доменным таблицам (EAV, операции, чат, аудит).
- Невозможность «подменить историю» без нарушения хэшей блоков.
- Шифрование чувствительных полей (`meta_json`, `payload_json`) при хранении в ledger.
 - SQL‑хранилища используются как проекции/кэши для UI и быстрых выборок.

## Где блокчейн особенно полезен
- **Акты/документы**: хранить on‑chain хэши файлов и метаданные, чтобы проверять подлинность.
- **Процессы ремонта**: фиксировать стадийные операции (`operations`) как события, чтобы строить доказуемый таймлайн.
- **Аудит и ответственность**: неизменяемый журнал действий сотрудников и админ‑операций.
- **Обновления**: on‑chain реестр релизов (version/fileName/size/SHA256) для проверки автообновлений.
- **Диагностика и контроль**: on‑chain снимки состояния для сверки клиент ↔ сервер.

## Основные эндпоинты
- `POST /ledger/tx/submit` — запись транзакций.
- `GET /ledger/state/changes?since=...` — изменения для клиента.
- `GET /ledger/state/query?table=...` — запросы к состоянию.
- `GET /ledger/blocks?since=...` — синхронизация блоков на узлы.
- `POST /ledger/releases/publish` — публикация релиза в on‑chain реестр (admin, обязательно).
- `GET /ledger/releases/latest` — последний релиз.

## End-to-end шифрование
- Включается на клиенте через `MATRICA_LEDGER_E2E=1`.
- Шифруются поля `meta_json` и `payload_json` **до** отправки в ledger.
- Сервер дополнительно шифрует только незашифрованные payload.

## Важные заметки
- Блокчейн не обеспечивает конфиденциальность сам по себе — для этого используется шифрование.
- Ledger‑ключи (`server-key.json`, `data-key.json`) хранятся только на сервере.
